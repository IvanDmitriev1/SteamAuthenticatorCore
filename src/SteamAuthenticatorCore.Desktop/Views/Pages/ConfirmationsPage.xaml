<ui:UiPage
    x:Class="SteamAuthenticatorCore.Desktop.Views.Pages.ConfirmationsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:SteamAuthenticatorCore.Desktop.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:SteamAuthenticatorCore.Shared.Models;assembly=SteamAuthenticatorCore.Shared"
    xmlns:steamAuthCore="clr-namespace:SteamAuthCore;assembly=SteamAuthCore"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:viewModels="clr-namespace:SteamAuthenticatorCore.Desktop.ViewModels"
    Title="ConfirmationsPage"
    d:DataContext="{d:DesignInstance viewModels:ConfirmationsViewModel,
                                     IsDesignTimeCreatable=False}"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <ui:Button
            Grid.Row="0"
            HorizontalAlignment="Stretch"
            Appearance="Primary"
            Command="{Binding Path=CheckConfirmationsCommand}"
            Content="Update" />

        <ScrollViewer
            Grid.Row="1"
            Margin="0,10,0,0"
            HorizontalScrollBarVisibility="Auto"
            VerticalScrollBarVisibility="Auto">

            <ItemsControl
                VerticalAlignment="Top"
                ItemsSource="{Binding Path=ConfirmationServiceBase.Accounts}"
                ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                ScrollViewer.VerticalScrollBarVisibility="Hidden"
                VirtualizingStackPanel.IsVirtualizing="True"
                VirtualizingStackPanel.VirtualizationMode="Recycling">

                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <VirtualizingStackPanel />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type models:ConfirmationAccountModelBase}">
                        <ui:Card>
                            <StackPanel>
                                <TextBlock
                                    Margin="1,0,0,15"
                                    FontSize="14"
                                    FontWeight="Medium"
                                    Text="{Binding Path=Account.AccountName}" />

                                <ListBox
                                    x:Name="ListBox"
                                    ItemsSource="{Binding Path=Confirmations}"
                                    SelectionMode="Extended"
                                    VirtualizingPanel.IsContainerVirtualizable="True"
                                    VirtualizingPanel.IsVirtualizing="True"
                                    VirtualizingPanel.VirtualizationMode="Recycling">

                                    <ListBox.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <VirtualizingStackPanel />
                                        </ItemsPanelTemplate>
                                    </ListBox.ItemsPanel>

                                    <ListBox.ItemTemplate>
                                        <DataTemplate DataType="{x:Type steamAuthCore:ConfirmationModel}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>

                                                <Image Grid.Column="0" Source="{Binding Path=ImageSource}" />

                                                <StackPanel
                                                    Grid.Column="1"
                                                    Margin="10,0,0,0"
                                                    VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding Path=ItemName}" />

                                                    <TextBlock Text="{Binding Path=Description}" />
                                                    <TextBlock Text="{Binding Path=Time}" />
                                                </StackPanel>
                                            </Grid>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>

                                <Grid Margin="0,10,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <Button
                                        Grid.Column="0"
                                        Margin="0,0,2.5,0"
                                        HorizontalAlignment="Stretch"
                                        Command="{Binding Path=ConfirmCommand}"
                                        CommandParameter="{Binding ElementName=ListBox, Path=SelectedItems}"
                                        Content="Confirm selected" />

                                    <ui:Button
                                        Grid.Column="1"
                                        Margin="2.5,0,0,0"
                                        HorizontalAlignment="Stretch"
                                        Appearance="Danger"
                                        Command="{Binding Path=CancelCommand}"
                                        CommandParameter="{Binding ElementName=ListBox, Path=SelectedItems}"
                                        Content="Cancel selected" />
                                </Grid>
                            </StackPanel>
                        </ui:Card>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</ui:UiPage>
